{% load static %}
<link rel="stylesheet" href="{% static 'css/style.css' %}">
<link rel="stylesheet" href="{% static 'css/footer.css' %}">
<link rel="stylesheet" href="https://cdn.datatables.net/1.10.12/css/jquery.dataTables.min.css">
<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">


<html>

    <body>

                <div class="card-title">
                    <h1>{{ node.symbol }}</h1>
                </div>

                {% if node.database == "Human" %}
                <!--HUMAN CARD -->
                    <h2>Show xrefs here :)</h2>

                {% else %}
                <!--PREDICTED NODE CARD -->
                    <h2>Sequence information</h2>
                    <hr>

                    <h3>Read sequence:</h3>
                    <a href="{% url get_fasta %}?genesymbol={{ node.symbol }}&database={{ node.database }}&type=sequence">
                        <div class="download-fasta-wrapper" title="Download FASTA file">
                            <img class="download-fasta" src="{% static 'Images/download-icon.png' %}">
                            Download FASTA
                        </div>
                    </a>
                    <div class="sequence-container">
                        <p>{{ node.sequence }}</p>
                    </div>

                    <h3>Longest Orf sequence:</h3>
                    <a href="{% url get_fasta %}?genesymbol={{ node.symbol }}&database={{ node.database }}&type=orf">
                        <div class="download-fasta-wrapper" title="Download FASTA file">
                            <img class="download-fasta" src="{% static 'Images/download-icon.png' %}">
                            Download FASTA
                        </div>
                    </a>
                    <div class="sequence-container">
                        <p>{{ node.orf }}</p>
                    </div>


                    <h2>Example of text and Link</h2>
                    <hr>
                    <p> So this is an example of a <a
                        class="card-link"
                        current="{{ node.symbol }}"
                        currentDB="{{ node.database }}"
                        target="UBC"
                        targetDB="Human">link</a>

                    <h2>Interactions</h2>
                    <hr>
                    {% if node.neighbours %}
                    <div class="int-table-container">
                        <table id="int-table" class="table table-hover int-table-class">
                            <thead>
                                <tr>
                                <th>Symbol</th>
                                <th>Probability</th>
                                <th>Path Length</th>
                                <th>Cellular Component NTO</th>
                                <th>Molecular Function NTO</th>
                                <th>Biological Process NTO</th>
                                <th>Domain Interaction Score</th>
                                </tr>
                            </thead>
                            <tbody>
                        {% for int in node.neighbours %}
                            <tr>
                                <td><a
                                    class="card-link"
                                    current="{{ node.symbol }}"
                                    currentDB="{{ node.database }}"
                                    target="{{ int.target.symbol }}"
                                    targetDB="{{ int.target.database }}">{{ int.target.symbol }}</a>
                                </td>
                                <td>{{ int.parameters.int_prob }}</td>
                                <td>{{ int.parameters.path_length }}</td>
                                <td>{{ int.parameters.cellcom_nto }}</td>
                                <td>{{ int.parameters.molfun_nto }}</td>
                                <td>{{ int.parameters.bioproc_nto }}</td>
                                <td>{{ int.parameters.dom_int_sc }}</td>
                            </tr>

                        {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                        <h3>No interactions</h3>
                    {% endif %}


                {% endif %}
    </body>


    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.12/js/jquery.dataTables.min.js"></script>

    <script>
        $('.card-link').click(function() {
            var card_data = {
                div_id    : $(this).closest('.card-overlay').attr("id"),
                current   : $(this).attr("current"),
                currentDB: $(this).attr("currentDB"),
                target    : $(this).attr("target"),
                targetDB : $(this).attr("targetDB"),
                csrfmiddlewaretoken: '{{ csrf_token }}'
            }

            history.pushState(card_data, null, "/gene_card/" + card_data['targetDB'] + "/" + card_data['target']);
            // Load Get request html on current card-overlay
            $.ajax({
                type: "GET",
                context: this, //this makes the this variable visible inside the success
                url: "{% url get_card %}",
                cache: true,
                data: {
                    'target'    : card_data['target'],
                    'current'   : card_data['current'],
                    'targetDB'  : card_data['targetDB'],
                    'currentDB' : card_data['currentDB'],
                    'csrfmiddlewaretoken': '{{ csrf_token }}'
                },
                success : function(data) {
                    $(this).closest('.card-overlay').html(data)
                    $(document).ready(function(){
                        $('.int-table-class').DataTable();
                    });
                }
            });


        });



        // This will check if the user is pressing the "back" button on his/her
        // browser. If that's the case, it will update the content of the "visible"
        // card-div.
        window.onpopstate = function(event) {
            if (event.state != null){
                console.log("AJAX!");
                $.ajax({
                    type: "GET",
                    context: this, //this makes the this variable visible inside the success
                    url: "{% url get_card %}",
                    cache: true,
                    data: {
                        'target'    : event.state['target'],
                        'targetDB'  : event.state['targetDB'],
                        'csrfmiddlewaretoken': '{{ csrf_token }}'
                    },
                    success : function(data) {
                        $('.card-overlay:visible').html(data)
                        $(document).ready(function(){
                            $('.int-table-class').DataTable();
                        });
                    }
                });
            }
        };

    </script>
</html>
