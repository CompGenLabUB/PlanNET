{% load static %}
{% load staticfiles %}


<html>
    <meta charset="utf-8">
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <link rel="stylesheet" href="{% static 'css/footer.css' %}">
    <link rel="stylesheet" href="{% static 'css/slider.css' %}">
    <link rel="stylesheet" href="{% static 'css/toggle-switch.css' %}">
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="{% static 'css/bootstrap-switch.min.css' %}">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.12/css/jquery.dataTables.min.css">
    <link rel="stylesheet" href="{% static 'css/jquery-ui.css' %}">
    <link rel="stylesheet" href="{% static 'css/jquery-ui.structure.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/jquery-ui.theme.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/bootstrap-select.min.css' %}">

    <head>
        <title>PlaNet - Pathway Finder</title>
    </head>
    <body>

        <!-- RESULTS -->
        <div id="pfind-results">
            <!-- CARD DIV -->
            <div id="button-container">
                <div class="close-overlay" title="Close card">
                    <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
                </div>
                <div class="full-screen-card" title="Open in new window">
                    <span class="glyphicon glyphicon-new-window" aria-hidden="true"></span>
                </div>
            </div>
            <div class="card-overlay" id="card-overlay"></div>

            <!-- PATHWAY RESULTS -->
            {% if pathways %}
                <div class="panel panel-warning">
                    <div class="panel-heading">
                        <h2>Results</h2>
                    </div>
                    <div class="panel-body pfind-res-panel">
                        <h4> <span class="glyphicon glyphicon-play" aria-hidden="true"></span> Search parameters:</h4>
                        <div id="search-param-pathway">
                            <img class="pfind-form-icon" src="{% static 'Images/database-icon.png' %}"/> Database:  <strong>{{ database }} </strong><br>
                            <img class="pfind-form-icon" src="{% static 'Images/starting-node-icon.png' %}"/> Starting Node: <strong>{{ snode }}</strong> <br>
                            <img class="pfind-form-icon" src="{% static 'Images/ending-node-icon.png' %}"/> Final Node: <strong>{{ enode }}</strong> <br>
                            <img class="pfind-form-icon" src="{% static 'Images/check.png' %}"/> Including: <strong> </strong> <br>
                            <img class="pfind-form-icon" src="{% static 'Images/uncheck.png' %}"/> Excluding: <strong> </strong> <br>
                        </div>
                        <h4> <span class="glyphicon glyphicon-play" aria-hidden="true"></span> Number of Pathways: <strong>{{ numpath }}</strong></h4>
                        <h4><span class="glyphicon glyphicon-play" aria-hidden="true"></span> Path Length: <strong>Unas cuantas</strong></h4>
                        <h4><span class="glyphicon glyphicon-play" aria-hidden="true"></span> Best Score: <strong>ejej</strong></h4>
                        <h4><span class="glyphicon glyphicon-play" aria-hidden="true"></span> Avg Score: <strong>ojoj</strong></h4>
                    </div>
                </div>

                <!-- FILTER FORM -->
                <div id="pathway-filter-div">
                    <form id="pathway-filter" class="form-inline">
                        <input id="pathway-filter-text" type="text" class="form-control" name="start" placeholder="Enter Symbol(s), separated by commas">
                        <input id="pathway-filter-submit" class="btn btn-warning" type="submit" value="Filter">
                    </form>
                </div>

                <h4>Showing <span id="numfiltered">{{ pathways|length }}</span> of {{ pathways|length }} pathways</h4>

                <!-- PATHWAYS -->
                {% for key, value in pathways.items %}
                    <div class="panel panel-default pathway-panel" id="panel{{ key }}" value='{{ value|safe }}' class="visible">
                        <div class="panel-heading">
                            <h3>Pathway #{{ key }} - Score: 123

                                <div class="row path-controls">
                                    <div class="col-md-6">
                                        <a title="Center Graph">
                                            <button id="center-to-graph-{{ key }}" class="btn btn-default" type="button">
                                                <span class="glyphicon glyphicon-resize-small" aria-hidden="true"></span>
                                            </button>
                                        </a>
                                    </div>
                                    <div class="col-md-6">
                                        <a title="View on NetExplorer">
                                            <button id="netexplorer-mini-{{ key }}" class="btn btn-default" type="button">
                                                <img src="{% static 'Images/netexplorer-mini.png' %}" class="netexplorer-mini"/>
                                            </button>
                                        </a>
                                    </div>
                                </div>

                                </h3>
                        </div>

                        <div class="panel-body">
                            <div id="pathway{{ key }}" class="pathway-container"></div>

                        </div>
                    </div>

                {% endfor %}
            {% endif %}
        </div>



        <!-- FORM -->
        <div id="pfind-form">
            <div id="pfind-form-header">
                <img src="{% static 'Images/pathway-icon.png' %}" class="app-icon-inside"/>
                <h2>Pathway Finder</h2>
                <a href="/">Back to PlaNet</a>
            </div>
            <hr>

            <!-- FORM -->
            <form method="GET" action="{% url path_finder %}">

                <!-- Select Database -->
                <select name="database" class="selectpicker" title="Select Database">
                    <option value="Cthulhu">Cthulhu</option>
                    <option value="Consolidated">Consolidated</option>
                    <option value="Human">Human</option>
                </select>


                <!-- START -->
                <div class="panel panel-warning pfind-form-element">
                    <div class="panel-heading pfind-input-header">
                        <img class="pfind-form-icon" src="{% static 'Images/starting-node-icon.png' %}"/> Starting Node
                    </div>
                    <div class="panel-body">
                        <input type="text" class="form-control" name="start" placeholder="Enter Symbol">
                    </div>
                </div>

                <!-- END -->
                <div class="panel panel-warning pfind-form-element">
                    <div class="panel-heading pfind-input-header">
                        <img class="pfind-form-icon" src="{% static 'Images/ending-node-icon.png' %}"/> Final Node
                    </div>
                    <div class="panel-body">
                        <input type="text" class="form-control" name="end" placeholder="Enter Symbol">
                    </div>
                </div>

                <!-- INCLUDING -->
                <div class="panel panel-warning pfind-form-element">
                    <div class="panel-heading pfind-input-header">
                        <img class="pfind-form-icon" src="{% static 'Images/check.png' %}"/> Including
                    </div>
                    <div class="panel-body">
                        <input type="text" class="form-control" name="including" placeholder="Enter Symbol">
                    </div>
                </div>

                <!-- EXCLUDING -->
                <div class="panel panel-warning pfind-form-element">
                    <div class="panel-heading pfind-input-header">
                        <img class="pfind-form-icon" src="{% static 'Images/uncheck.png' %}"/> Excluding
                    </div>
                    <div class="panel-body">
                            <input type="text" class="form-control" name="excluding" placeholder="Enter Symbol">
                    </div>
                </div>

                <br>
                <br>
                <button id="pfind-btn" type="submit" class="btn btn-warning">
                    <span class="glyphicon glyphicon-search" aria-hidden="true"></span>
                    Find
                </button>
            </form>



        </div>


        <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
        <script src="{% static 'js/bootstrap.min.js' %}"></script>
        <script src="{% static 'js/bootstrap-select.min.js' %}"></script>
        <script src="{% static 'js/overlay.js' %}"></script>
        <script src="{% static 'js/cytoscape.js' %}"></script>
        <script src="{% static 'js/cyto-stylesheet-pathway.js' %}"></script>
        <script src="{% static 'js/getCard.js' %}"></script>
        <script src="{% static 'js/cyto-pathway.js' %}"></script>
        <script src="{% static 'js/filterPathways.js' %}"></script>
        {% if pathways %}
            {% for key, value in pathways.items %}
                <script>
                    $(document).ready(function(){
                        var cy = cytoscape({
                            style: stylesheet,
                            layout: { name: 'preset' },
                            container: document.getElementById('pathway{{ key }}'),
                            ready: function() {}
                        });
                        var elements = {{ value|safe }};
                        cy.load(elements)
                        cy.layout({
                            name: 'grid',
                            maxSimulationTime: 3000,
                            fit: true,
                            directed: false,
                            padding: 40
                        });

                        // Behaviour when clicking on node: will display card
                        cy.on( 'click', 'node', function() {
                            node = this;
                            var card_data = {
                                target  : this.data("name"),
                                targetDB: this.data("database"),
                                csrfmiddlewaretoken: '{{ csrf_token }}'
                            };
                            getCard(card_data);
                        });

                        // Behaviour when mousover
                        cy.on( 'mousover', 'node', function() {
                            // show card message
                        });

                        // Center to graph
                        $("#center-to-graph-{{ key }}").on("click", function(){
                            cy.center();
                            cy.fit();
                        });

                    });
                </script>
            {% endfor %}
        {% endif %}
    </body>

</html>
